<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Food - Hệ Thống Gợi Ý Món Ăn Thông Minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'viet-gold': '#D4AF37',
                        'viet-red': '#DA020E',
                        'viet-green': '#228B22',
                        'bamboo': '#8FBC8F'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }
        
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .nav-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(212, 175, 55, 0.1);
        }
        
        .nav-item.active {
            background: rgba(212, 175, 55, 0.2);
            border-bottom: 3px solid #D4AF37;
        }
        
        .mood-selector {
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 12px;
            border-radius: 50%;
            border: 3px solid transparent;
        }
        
        .mood-selector:hover {
            transform: scale(1.15);
            background: rgba(212, 175, 55, 0.15);
            border-color: rgba(212, 175, 55, 0.3);
        }
        
        .mood-selector.active {
            transform: scale(1.2);
            background: rgba(212, 175, 55, 0.25);
            border-color: #D4AF37;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="bg-white/95 backdrop-blur-md shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="text-3xl">🍜</div>
                    <div>
                        <span class="text-xl font-bold text-viet-red">Smart Food</span>
                        <div class="text-xs text-gray-500">AI Food Recommendation System</div>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <div class="hidden md:flex items-center space-x-1" id="mainNav">
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700 active" data-page="home">🏠 Trang chủ</div>
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700" data-page="recommendations">🎯 Gợi ý món ăn</div>
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700" data-page="mealPlan">📅 Kế hoạch ăn uống</div>
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700" data-page="recipes">📖 Công thức</div>
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700" data-page="health">💪 Sức khỏe</div>
                    <div class="nav-item px-4 py-2 rounded-lg font-medium text-gray-700" data-page="community">👥 Cộng đồng</div>
                </div>
                
                <!-- User Menu -->
                <div class="flex items-center space-x-4">
                    <div id="userMenu" class="hidden items-center space-x-3">
                        <div class="text-sm">
                            <div class="font-semibold" id="userName">Chào bạn!</div>
                            <div class="text-gray-500 text-xs" id="userLevel">Level 1</div>
                        </div>
                        <img id="userAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23D4AF37'/%3E%3Ctext x='20' y='26' text-anchor='middle' fill='white' font-size='16'%3E👤%3C/text%3E%3C/svg%3E" class="w-10 h-10 rounded-full cursor-pointer">
                        <button id="logoutBtn" class="text-gray-500 hover:text-gray-700">🚪</button>
                    </div>
                    <div id="loginSection" class="flex items-center space-x-2">
                        <button id="loginBtn" class="bg-viet-red text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-all">
                            Đăng nhập
                        </button>
                        <button id="registerBtn" class="border border-viet-red text-viet-red px-4 py-2 rounded-lg font-medium hover:bg-viet-red hover:text-white transition-all">
                            Đăng ký
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        
        <!-- Home Page -->
        <div id="homePage" class="page active">
            <!-- Hero Section -->
            <section class="hero-gradient text-white py-16 relative overflow-hidden rounded-2xl my-8">
                <div class="absolute inset-0 bg-black/10"></div>
                <div class="text-center relative z-10 px-8">
                    <div class="mb-8">
                        <div class="text-5xl mb-4">🎯</div>
                        <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
                            Hệ Thống Gợi Ý Món Ăn Thông Minh
                        </h1>
                        <p class="text-lg md:text-xl mb-6 max-w-3xl mx-auto leading-relaxed">
                            Sử dụng AI để phân tích <span class="text-yellow-300 font-semibold">6 yếu tố quan trọng</span><br>
                            và đưa ra gợi ý món ăn hoàn hảo dành riêng cho bạn
                        </p>
                        <div class="flex flex-wrap justify-center gap-3 text-sm mb-8">
                            <span class="bg-white/20 px-3 py-1 rounded-full">🏋️ Sức khỏe</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">⏰ Thời gian</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">📍 Địa điểm</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">😋 Sở thích</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">🌦️ Tâm trạng</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">🎯 Mục tiêu</span>
                        </div>
                        <button class="nav-item bg-white text-viet-red px-8 py-4 rounded-xl font-bold text-lg hover:bg-gray-100 transition-all transform hover:scale-105" data-page="recommendations">
                            🚀 Bắt đầu ngay
                        </button>
                    </div>
                </div>
            </section>

            <!-- Features Grid -->
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8 py-16">
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">🤖</div>
                    <h3 class="text-xl font-bold mb-4">AI Thông Minh</h3>
                    <p class="text-gray-600">Phân tích 6 yếu tố để đưa ra gợi ý món ăn phù hợp nhất với bạn</p>
                </div>
                
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">📊</div>
                    <h3 class="text-xl font-bold mb-4">Theo Dõi Sức Khỏe</h3>
                    <p class="text-gray-600">Thống kê calories, dinh dưỡng và tiến độ sức khỏe hàng ngày</p>
                </div>
                
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">📅</div>
                    <h3 class="text-xl font-bold mb-4">Kế Hoạch Ăn Uống</h3>
                    <p class="text-gray-600">Lập kế hoạch bữa ăn thông minh cho cả tuần</p>
                </div>
                
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">📖</div>
                    <h3 class="text-xl font-bold mb-4">Kho Công Thức</h3>
                    <p class="text-gray-600">Hàng nghìn công thức nấu ăn với hướng dẫn chi tiết</p>
                </div>
                
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">👥</div>
                    <h3 class="text-xl font-bold mb-4">Cộng Đồng</h3>
                    <p class="text-gray-600">Chia sẻ kinh nghiệm và học hỏi từ cộng đồng yêu ẩm thực</p>
                </div>
                
                <div class="bg-white rounded-2xl p-8 shadow-lg card-hover text-center">
                    <div class="text-5xl mb-4">🎯</div>
                    <h3 class="text-xl font-bold mb-4">Cá Nhân Hóa</h3>
                    <p class="text-gray-600">Điều chỉnh trọng số theo sở thích cá nhân</p>
                </div>
            </div>
        </div>

        <!-- Recommendations Page -->
        <div id="recommendationsPage" class="page py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">🎯 Gợi Ý Món Ăn Thông Minh</h1>
                <p class="text-gray-600 text-lg">AI phân tích 6 yếu tố để tìm món ăn hoàn hảo cho bạn</p>
            </div>
            
            <!-- Mood Selection -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-center mb-6">🌟 Tâm trạng của bạn hôm nay?</h2>
                <div class="grid grid-cols-3 md:grid-cols-6 gap-4 justify-items-center" id="moodSelector">
                    <div class="mood-selector" data-mood="happy" title="Vui vẻ">😊</div>
                    <div class="mood-selector" data-mood="sad" title="Buồn">😢</div>
                    <div class="mood-selector" data-mood="stressed" title="Căng thẳng">😰</div>
                    <div class="mood-selector" data-mood="excited" title="Hứng thú">🤩</div>
                    <div class="mood-selector" data-mood="tired" title="Mệt mỏi">😴</div>
                    <div class="mood-selector" data-mood="romantic" title="Lãng mạn">😍</div>
                </div>
                <div class="text-center mt-4">
                    <span id="selectedMoodText" class="text-lg font-semibold text-viet-red">Chọn tâm trạng để bắt đầu</span>
                </div>
            </div>

            <!-- Factor Analysis -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold text-center mb-6">⚖️ Điều chỉnh độ ưu tiên</h2>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">🏋️</span>
                                Sức khỏe
                            </span>
                            <span id="healthValue" class="text-viet-red font-bold">70%</span>
                        </div>
                        <input type="range" id="healthSlider" min="0" max="100" value="70" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                    
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">⏰</span>
                                Thời gian
                            </span>
                            <span id="timeValue" class="text-viet-red font-bold">60%</span>
                        </div>
                        <input type="range" id="timeSlider" min="0" max="100" value="60" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                    
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">📍</span>
                                Địa điểm
                            </span>
                            <span id="locationValue" class="text-viet-red font-bold">50%</span>
                        </div>
                        <input type="range" id="locationSlider" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                    
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">😋</span>
                                Sở thích
                            </span>
                            <span id="preferenceValue" class="text-viet-red font-bold">80%</span>
                        </div>
                        <input type="range" id="preferenceSlider" min="0" max="100" value="80" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                    
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">🌦️</span>
                                Tâm trạng
                            </span>
                            <span id="moodValue" class="text-viet-red font-bold">65%</span>
                        </div>
                        <input type="range" id="moodSlider" min="0" max="100" value="65" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                    
                    <div class="factor-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="font-semibold flex items-center">
                                <span class="text-2xl mr-2">🎯</span>
                                Mục tiêu
                            </span>
                            <span id="goalValue" class="text-viet-red font-bold">55%</span>
                        </div>
                        <input type="range" id="goalSlider" min="0" max="100" value="55" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                    </div>
                </div>
                
                <div class="text-center mt-6">
                    <button id="generateRecommendations" class="bg-viet-red text-white px-8 py-3 rounded-xl font-bold hover:bg-red-600 transition-all">
                        🤖 Tạo gợi ý AI
                    </button>
                </div>
            </div>

            <!-- AI Analysis Results -->
            <div id="analysisResults" class="bg-white rounded-2xl shadow-lg p-8 mb-8" style="display: none;">
                <h2 class="text-2xl font-bold text-center mb-6">🧠 Phân Tích AI</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">📊 Trọng số yếu tố</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between items-center">
                                <span>🏋️ Sức khỏe</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div id="healthBar" class="bg-viet-red h-2 rounded-full transition-all" style="width: 70%"></div>
                                    </div>
                                    <span id="healthPercent" class="text-sm font-semibold">70%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>⏰ Thời gian</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div id="timeBar" class="bg-viet-red h-2 rounded-full transition-all" style="width: 60%"></div>
                                    </div>
                                    <span id="timePercent" class="text-sm font-semibold">60%</span>
                                </div>
                            </div>
                            <div class="flex justify-between items-center">
                                <span>😋 Sở thích</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-24 bg-gray-200 rounded-full h-2">
                                        <div id="preferenceBar" class="bg-viet-red h-2 rounded-full transition-all" style="width: 80%"></div>
                                    </div>
                                    <span id="preferencePercent" class="text-sm font-semibold">80%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-semibold mb-4">🎯 Khuyến nghị</h3>
                        <div class="space-y-2 text-sm">
                            <div id="recommendation1" class="p-3 bg-green-50 rounded-lg">✅ Ưu tiên món ăn healthy</div>
                            <div id="recommendation2" class="p-3 bg-blue-50 rounded-lg">⏱️ Chọn món nấu nhanh</div>
                            <div id="recommendation3" class="p-3 bg-yellow-50 rounded-lg">😋 Phù hợp sở thích cá nhân</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Food Recommendations -->
            <div id="foodRecommendations" class="bg-white rounded-2xl shadow-lg p-8" style="display: none;">
                <h2 class="text-2xl font-bold text-center mb-6">🍽️ Gợi Ý Món Ăn</h2>
                <div class="grid md:grid-cols-3 gap-8" id="recommendationCards">
                    <!-- Cards will be generated by JavaScript -->
                </div>
                
                <div class="mt-8 text-center">
                    <button id="regenerateBtn" class="bg-viet-red text-white px-8 py-3 rounded-xl font-bold hover:bg-red-600 transition-all">
                        🔄 Tạo gợi ý mới
                    </button>
                </div>
            </div>

            <!-- AI Chat for Recommendations -->
            <div id="recommendationChat" class="bg-white rounded-2xl shadow-lg p-6 mt-8" style="display: none;">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <span class="text-3xl mr-3">🤖</span>
                    Chat với AI về món ăn
                </h2>
                
                <div id="recChatContainer" class="bg-gray-50 rounded-xl p-4 h-48 overflow-y-auto mb-4">
                    <div class="chat-message ai-message mb-3">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">🤖</div>
                            <div class="bg-blue-100 rounded-lg p-3 max-w-xs">
                                <p class="text-sm">Bạn có muốn điều chỉnh gợi ý món ăn không? Tôi có thể thay đổi theo sở thích của bạn!</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <input type="text" id="recChatInput" placeholder="Ví dụ: Tôi không thích cay, thay món khác..." 
                           class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-viet-red">
                    <button id="sendRecChatBtn" class="bg-viet-red text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-all">
                        Gửi
                    </button>
                </div>
                
                <div class="mt-4 flex flex-wrap gap-2">
                    <button class="rec-quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Tôi không thích cay">
                        🌶️ Không thích cay
                    </button>
                    <button class="rec-quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Muốn món chay">
                        🥬 Món chay
                    </button>
                    <button class="rec-quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Thêm món tráng miệng">
                        🍰 Tráng miệng
                    </button>
                    <button class="rec-quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Món ăn nhanh">
                        ⚡ Ăn nhanh
                    </button>
                </div>
            </div>
        </div>

        <!-- Meal Plan Page -->
        <div id="mealPlanPage" class="page py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">📅 Kế Hoạch Ăn Uống</h1>
                <p class="text-gray-600 text-lg">Lập kế hoạch bữa ăn thông minh cho cả tuần</p>
            </div>
            
            <!-- AI Chat Section -->
            <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-bold mb-4 flex items-center">
                    <span class="text-3xl mr-3">🤖</span>
                    Chat với AI Assistant
                </h2>
                
                <div id="chatContainer" class="bg-gray-50 rounded-xl p-4 h-64 overflow-y-auto mb-4">
                    <div class="chat-message ai-message mb-3">
                        <div class="flex items-start space-x-3">
                            <div class="text-2xl">🤖</div>
                            <div class="bg-blue-100 rounded-lg p-3 max-w-xs">
                                <p class="text-sm">Xin chào! Tôi có thể giúp bạn điều chỉnh kế hoạch ăn uống. Bạn muốn thay đổi món nào không?</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <input type="text" id="chatInput" placeholder="Ví dụ: Thay món sáng thứ 2 thành cháo..." 
                           class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-viet-red">
                    <button id="sendChatBtn" class="bg-viet-red text-white px-6 py-2 rounded-lg hover:bg-red-600 transition-all">
                        Gửi
                    </button>
                </div>
                
                <div class="mt-4 flex flex-wrap gap-2">
                    <button class="quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Tôi muốn ăn healthy hơn">
                        🥗 Ăn healthy hơn
                    </button>
                    <button class="quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Thay đổi món Việt Nam">
                        🍜 Món Việt Nam
                    </button>
                    <button class="quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Giảm calories">
                        🔥 Giảm calories
                    </button>
                    <button class="quick-chat-btn bg-gray-100 hover:bg-gray-200 px-3 py-1 rounded-full text-sm transition-all" 
                            data-message="Món nấu nhanh">
                        ⚡ Nấu nhanh
                    </button>
                </div>
            </div>

            <!-- Smart Meal Suggestions -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <span class="text-3xl mr-3">🎯</span>
                    Gợi ý món ăn thông minh
                </h2>
                
                <div class="grid md:grid-cols-3 gap-6 mb-6">
                    <div class="text-center">
                        <div class="text-4xl mb-2">🏃‍♂️</div>
                        <h3 class="font-semibold mb-2">Mục tiêu sức khỏe</h3>
                        <select id="healthGoalSelect" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="maintain">Duy trì sức khỏe</option>
                            <option value="lose">Giảm cân</option>
                            <option value="gain">Tăng cân</option>
                            <option value="muscle">Tăng cơ bắp</option>
                        </select>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-4xl mb-2">⏰</div>
                        <h3 class="font-semibold mb-2">Thời gian nấu ăn</h3>
                        <select id="cookingTimeSelect" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="any">Không giới hạn</option>
                            <option value="quick">Nhanh (< 30 phút)</option>
                            <option value="medium">Trung bình (30-60 phút)</option>
                            <option value="slow">Chậm (> 60 phút)</option>
                        </select>
                    </div>
                    
                    <div class="text-center">
                        <div class="text-4xl mb-2">🌱</div>
                        <h3 class="font-semibold mb-2">Chế độ ăn</h3>
                        <select id="dietTypeSelect" class="w-full border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="normal">Bình thường</option>
                            <option value="vegetarian">Chay</option>
                            <option value="healthy">Healthy</option>
                            <option value="traditional">Truyền thống</option>
                        </select>
                    </div>
                </div>
                
                <div class="text-center">
                    <button id="generateSmartPlanBtn" class="bg-gradient-to-r from-purple-600 to-blue-600 text-white px-8 py-3 rounded-xl font-bold hover:from-purple-700 hover:to-blue-700 transition-all">
                        🤖 Tạo kế hoạch thông minh
                    </button>
                </div>
            </div>

            <!-- Weekly Meal Plan -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">📋 Kế hoạch tuần này</h2>
                    <div class="flex space-x-2">
                        <button id="prevWeekBtn" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                            ← Tuần trước
                        </button>
                        <button id="nextWeekBtn" class="bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-lg transition-all">
                            Tuần sau →
                        </button>
                    </div>
                </div>
                
                <div id="weeklyPlan" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-7 gap-4">
                    <!-- Days will be generated by JavaScript -->
                </div>
                
                <div class="mt-8 flex justify-center space-x-4">
                    <button id="generatePlanBtn" class="bg-viet-red text-white px-8 py-3 rounded-xl font-bold hover:bg-red-600 transition-all">
                        🎯 Tạo kế hoạch mới
                    </button>
                    <button id="savePlanBtn" class="bg-green-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-green-700 transition-all">
                        💾 Lưu kế hoạch
                    </button>
                </div>
            </div>

            <!-- Nutrition Summary -->
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">📊 Tổng quan dinh dưỡng tuần</h2>
                <div class="grid md:grid-cols-4 gap-6">
                    <div class="text-center">
                        <div class="text-4xl mb-2">🔥</div>
                        <div class="text-2xl font-bold text-red-600" id="weeklyCalories">2,100</div>
                        <div class="text-sm text-gray-500">Calories/ngày</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-2">🥩</div>
                        <div class="text-2xl font-bold text-blue-600" id="weeklyProtein">95g</div>
                        <div class="text-sm text-gray-500">Protein/ngày</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-2">🍞</div>
                        <div class="text-2xl font-bold text-green-600" id="weeklyCarbs">250g</div>
                        <div class="text-sm text-gray-500">Carbs/ngày</div>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-2">🥑</div>
                        <div class="text-2xl font-bold text-yellow-600" id="weeklyFat">70g</div>
                        <div class="text-sm text-gray-500">Fat/ngày</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recipes Page -->
        <div id="recipesPage" class="page py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">📖 Kho Công Thức</h1>
                <p class="text-gray-600 text-lg">Khám phá hàng nghìn công thức nấu ăn chi tiết</p>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🍜</div>
                        <h3 class="text-xl font-bold mb-2">Phở Bò Hà Nội</h3>
                        <p class="text-gray-600 text-sm mb-4">Công thức phở bò truyền thống với nước dùng trong vắt</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 45 phút</span>
                            <span>👥 4 người</span>
                            <span>⭐ 4.8</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🥗</div>
                        <h3 class="text-xl font-bold mb-2">Salad Quinoa Healthy</h3>
                        <p class="text-gray-600 text-sm mb-4">Salad quinoa bổ dưỡng với rau củ tươi và sốt chanh dây</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 20 phút</span>
                            <span>👥 2 người</span>
                            <span>⭐ 4.6</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🍲</div>
                        <h3 class="text-xl font-bold mb-2">Bún Bò Huế</h3>
                        <p class="text-gray-600 text-sm mb-4">Bún bò cay nồng đặc trưng miền Trung với chả cua</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 60 phút</span>
                            <span>👥 4 người</span>
                            <span>⭐ 4.7</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🍛</div>
                        <h3 class="text-xl font-bold mb-2">Cơm Gà Hải Nam</h3>
                        <p class="text-gray-600 text-sm mb-4">Cơm gà thơm ngon với nước chấm đặc biệt</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 50 phút</span>
                            <span>👥 3 người</span>
                            <span>⭐ 4.5</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🥘</div>
                        <h3 class="text-xl font-bold mb-2">Cà Ri Gà</h3>
                        <p class="text-gray-600 text-sm mb-4">Cà ri gà đậm đà với nước cốt dừa và gia vị</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 40 phút</span>
                            <span>👥 4 người</span>
                            <span>⭐ 4.4</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden card-hover">
                    <div class="p-6">
                        <div class="text-6xl text-center mb-4">🍝</div>
                        <h3 class="text-xl font-bold mb-2">Mì Ý Carbonara</h3>
                        <p class="text-gray-600 text-sm mb-4">Mì Ý Carbonara kiểu Ý với bacon và phô mai</p>
                        <div class="flex items-center justify-between text-sm text-gray-500 mb-4">
                            <span>⏱️ 25 phút</span>
                            <span>👥 2 người</span>
                            <span>⭐ 4.6</span>
                        </div>
                        <button class="w-full bg-viet-red text-white py-2 rounded-xl font-semibold hover:bg-red-600 transition-all">
                            Xem chi tiết
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Page -->
        <div id="healthPage" class="page py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">💪 Theo Dõi Sức Khỏe</h1>
                <p class="text-gray-600 text-lg">Thống kê chi tiết về dinh dưỡng và tiến độ sức khỏe</p>
            </div>
            
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">🔥</div>
                    <div class="text-2xl font-bold">1,650</div>
                    <div class="text-sm opacity-90">/ 2,000 calories</div>
                    <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                        <div class="bg-white h-2 rounded-full" style="width: 82.5%"></div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-blue-500 to-cyan-600 text-white rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">🥩</div>
                    <div class="text-2xl font-bold">95g</div>
                    <div class="text-sm opacity-90">/ 120g protein</div>
                    <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                        <div class="bg-white h-2 rounded-full" style="width: 79%"></div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-green-500 to-teal-600 text-white rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">🍞</div>
                    <div class="text-2xl font-bold">180g</div>
                    <div class="text-sm opacity-90">/ 250g carbs</div>
                    <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                        <div class="bg-white h-2 rounded-full" style="width: 72%"></div>
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-yellow-500 to-orange-600 text-white rounded-2xl p-6 text-center">
                    <div class="text-3xl mb-2">🥑</div>
                    <div class="text-2xl font-bold">45g</div>
                    <div class="text-sm opacity-90">/ 65g fat</div>
                    <div class="w-full bg-white/20 rounded-full h-2 mt-2">
                        <div class="bg-white h-2 rounded-full" style="width: 69%"></div>
                    </div>
                </div>
            </div>
            
            <div class="bg-white rounded-2xl shadow-lg p-8">
                <h3 class="text-2xl font-semibold mb-6">🍽️ Lịch sử bữa ăn hôm nay</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center space-x-4">
                            <div class="text-3xl">🍜</div>
                            <div>
                                <div class="font-semibold">Phở Bò</div>
                                <div class="text-sm text-gray-500">07:30 • Sáng</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-viet-red">350</div>
                            <div class="text-xs text-gray-500">calories</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center space-x-4">
                            <div class="text-3xl">🥗</div>
                            <div>
                                <div class="font-semibold">Salad Quinoa</div>
                                <div class="text-sm text-gray-500">12:15 • Trưa</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-viet-red">280</div>
                            <div class="text-xs text-gray-500">calories</div>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                        <div class="flex items-center space-x-4">
                            <div class="text-3xl">🥤</div>
                            <div>
                                <div class="font-semibold">Smoothie</div>
                                <div class="text-sm text-gray-500">15:30 • Snack</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-viet-red">150</div>
                            <div class="text-xs text-gray-500">calories</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Community Page -->
        <div id="communityPage" class="page py-8">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold mb-4">👥 Cộng Đồng Ẩm Thực</h1>
                <p class="text-gray-600 text-lg">Chia sẻ kinh nghiệm và kết nối với những người yêu ẩm thực</p>
            </div>
            
            <div class="space-y-6">
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">👨‍🍳</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="font-semibold">Chef Minh</span>
                                <span class="text-sm text-gray-500">2 giờ trước</span>
                            </div>
                            <h4 class="font-bold text-lg mb-2">Bí quyết làm phở bò nước dùng trong vắt</h4>
                            <p class="text-gray-600 mb-4">Sau 10 năm làm nghề, tôi muốn chia sẻ bí quyết để có nước dùng phở trong vắt và thơm ngon. Điều quan trọng nhất là...</p>
                            <div class="text-6xl text-center my-4">🍜</div>
                            <div class="flex items-center space-x-6 text-sm text-gray-500">
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>👍</span>
                                    <span>245</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>💬</span>
                                    <span>32</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>📤</span>
                                    <span>18</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">👩‍🍳</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="font-semibold">Healthy Mom</span>
                                <span class="text-sm text-gray-500">4 giờ trước</span>
                            </div>
                            <h4 class="font-bold text-lg mb-2">Bữa sáng healthy cho cả gia đình</h4>
                            <p class="text-gray-600 mb-4">Smoothie bowl với granola tự làm và trái cây tươi. Các bé rất thích và đầy đủ dinh dưỡng cho ngày mới!</p>
                            <div class="text-6xl text-center my-4">🍓</div>
                            <div class="flex items-center space-x-6 text-sm text-gray-500">
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>👍</span>
                                    <span>189</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>💬</span>
                                    <span>24</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>📤</span>
                                    <span>12</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-lg p-6">
                    <div class="flex items-start space-x-4">
                        <div class="text-3xl">🍽️</div>
                        <div class="flex-1">
                            <div class="flex items-center space-x-2 mb-2">
                                <span class="font-semibold">Foodie Hà Nội</span>
                                <span class="text-sm text-gray-500">6 giờ trước</span>
                            </div>
                            <h4 class="font-bold text-lg mb-2">Làm sao để bánh mì giòn lâu hơn?</h4>
                            <p class="text-gray-600 mb-4">Mình hay làm bánh mì ở nhà nhưng không giòn được lâu như ngoài hàng. Có bạn nào biết bí quyết không ạ?</p>
                            <div class="text-6xl text-center my-4">🥖</div>
                            <div class="flex items-center space-x-6 text-sm text-gray-500">
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>👍</span>
                                    <span>67</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>💬</span>
                                    <span>45</span>
                                </button>
                                <button class="flex items-center space-x-1 hover:text-viet-red transition-all">
                                    <span>📤</span>
                                    <span>8</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification bg-white rounded-xl shadow-2xl p-4 max-w-sm">
        <div class="flex items-center space-x-3">
            <div class="text-2xl" id="notificationIcon">✅</div>
            <div>
                <div class="font-semibold" id="notificationTitle">Thành công!</div>
                <div class="text-sm text-gray-600" id="notificationMessage">Thao tác đã được thực hiện</div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentPage = 'home';
        let selectedMood = null;
        let factorWeights = {
            health: 70,
            time: 60,
            location: 50,
            preference: 80,
            mood: 65,
            goal: 55
        };

        // Food database
        const foodDatabase = [
            // Breakfast foods
            { name: "Phở Bò Hà Nội", emoji: "🍜", description: "Món phở truyền thống với nước dùng trong vắt", health: 75, time: 30, preference: 90, mood: ["happy", "tired"], calories: 350, cookTime: "45 phút", type: "breakfast", category: "traditional" },
            { name: "Smoothie Bowl", emoji: "🍓", description: "Smoothie bowl với granola và trái cây tươi", health: 90, time: 90, preference: 75, mood: ["excited", "happy"], calories: 250, cookTime: "15 phút", type: "breakfast", category: "healthy" },
            { name: "Bánh Mì Thịt Nướng", emoji: "🥖", description: "Bánh mì giòn với thịt nướng thơm lừng", health: 65, time: 80, preference: 92, mood: ["happy", "tired"], calories: 320, cookTime: "25 phút", type: "breakfast", category: "traditional" },
            { name: "Cháo Tôm", emoji: "🥣", description: "Cháo tôm mềm mịn, bổ dưỡng", health: 85, time: 70, preference: 80, mood: ["sad", "tired"], calories: 200, cookTime: "35 phút", type: "breakfast", category: "healthy" },
            { name: "Bánh Cuốn", emoji: "🥟", description: "Bánh cuốn mỏng với nhân thịt thơm ngon", health: 80, time: 60, preference: 85, mood: ["happy"], calories: 280, cookTime: "40 phút", type: "breakfast", category: "traditional" },
            { name: "Trứng Chiên", emoji: "🍳", description: "Trứng chiên đơn giản, nhanh gọn", health: 70, time: 95, preference: 80, mood: ["tired"], calories: 180, cookTime: "10 phút", type: "breakfast", category: "quick" },
            
            // Lunch foods
            { name: "Cơm Gà Hải Nam", emoji: "🍛", description: "Cơm gà thơm ngon với nước chấm đặc biệt", health: 80, time: 60, preference: 88, mood: ["romantic", "happy"], calories: 380, cookTime: "50 phút", type: "lunch", category: "traditional" },
            { name: "Salad Quinoa", emoji: "🥗", description: "Salad healthy với quinoa và rau củ tươi", health: 95, time: 85, preference: 70, mood: ["stressed", "excited"], calories: 280, cookTime: "20 phút", type: "lunch", category: "healthy" },
            { name: "Bún Bò Huế", emoji: "🍲", description: "Bún bò cay nồng đặc trưng miền Trung", health: 70, time: 40, preference: 85, mood: ["happy", "excited"], calories: 420, cookTime: "60 phút", type: "lunch", category: "traditional" },
            { name: "Cơm Tấm", emoji: "🍚", description: "Cơm tấm sườn nướng đặc sản Sài Gòn", health: 65, time: 50, preference: 90, mood: ["happy"], calories: 450, cookTime: "45 phút", type: "lunch", category: "traditional" },
            { name: "Mì Quảng", emoji: "🍜", description: "Mì Quảng đậm đà hương vị miền Trung", health: 75, time: 45, preference: 85, mood: ["excited"], calories: 380, cookTime: "55 phút", type: "lunch", category: "traditional" },
            { name: "Salad Gà Nướng", emoji: "🥙", description: "Salad với gà nướng và rau xanh tươi", health: 90, time: 80, preference: 75, mood: ["stressed"], calories: 320, cookTime: "25 phút", type: "lunch", category: "healthy" },
            
            // Dinner foods
            { name: "Lẩu Thái", emoji: "🍲", description: "Lẩu Thái chua cay với hải sản tươi ngon", health: 75, time: 50, preference: 85, mood: ["excited", "romantic"], calories: 300, cookTime: "40 phút", type: "dinner", category: "traditional" },
            { name: "Cà Ri Gà", emoji: "🥘", description: "Cà ri gà đậm đà với nước cốt dừa", health: 70, time: 55, preference: 80, mood: ["romantic"], calories: 400, cookTime: "50 phút", type: "dinner", category: "traditional" },
            { name: "Cá Nướng", emoji: "🐟", description: "Cá nướng thơm lừng với rau sống", health: 85, time: 70, preference: 85, mood: ["happy"], calories: 350, cookTime: "35 phút", type: "dinner", category: "healthy" },
            { name: "Thịt Kho Tàu", emoji: "🥩", description: "Thịt kho tàu đậm đà truyền thống", health: 60, time: 40, preference: 88, mood: ["sad", "tired"], calories: 420, cookTime: "70 phút", type: "dinner", category: "traditional" },
            { name: "Canh Chua", emoji: "🍜", description: "Canh chua cá thanh mát miền Nam", health: 80, time: 65, preference: 80, mood: ["happy"], calories: 180, cookTime: "30 phút", type: "dinner", category: "healthy" },
            { name: "Gỏi Cuốn", emoji: "🌯", description: "Gỏi cuốn tươi mát với tôm thịt", health: 90, time: 85, preference: 75, mood: ["excited"], calories: 220, cookTime: "20 phút", type: "dinner", category: "healthy" },
            
            // Vegetarian options
            { name: "Cơm Chay", emoji: "🍚", description: "Cơm chay đầy đủ dinh dưỡng", health: 85, time: 70, preference: 70, mood: ["stressed"], calories: 300, cookTime: "35 phút", type: "lunch", category: "vegetarian" },
            { name: "Phở Chay", emoji: "🍜", description: "Phở chay thanh đạm, bổ dưỡng", health: 90, time: 60, preference: 75, mood: ["sad"], calories: 280, cookTime: "40 phút", type: "breakfast", category: "vegetarian" },
            { name: "Salad Trái Cây", emoji: "🥗", description: "Salad trái cây tươi mát", health: 95, time: 90, preference: 70, mood: ["excited"], calories: 150, cookTime: "15 phút", type: "breakfast", category: "vegetarian" },
            
            // Quick meals
            { name: "Sandwich", emoji: "🥪", description: "Sandwich nhanh gọn, tiện lợi", health: 70, time: 95, preference: 80, mood: ["tired"], calories: 300, cookTime: "10 phút", type: "breakfast", category: "quick" },
            { name: "Mì Ý", emoji: "🍝", description: "Mì Ý sốt cà chua thơm ngon", health: 65, time: 85, preference: 85, mood: ["happy"], calories: 380, cookTime: "20 phút", type: "lunch", category: "quick" },
            { name: "Cơm Chiên", emoji: "🍛", description: "Cơm chiên dương châu đậm đà", health: 60, time: 80, preference: 90, mood: ["excited"], calories: 420, cookTime: "25 phút", type: "dinner", category: "quick" }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeNavigation();
            initializeAuth();
            initializeRecommendationSystem();
            initializeMealPlan();
        });

        // Navigation system
        function initializeNavigation() {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                item.addEventListener('click', function() {
                    const targetPage = this.dataset.page;
                    if (targetPage) {
                        navigateToPage(targetPage);
                    }
                });
            });
        }

        function navigateToPage(pageName) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show target page
            const targetPage = document.getElementById(pageName + 'Page');
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageName;
                
                // Update navigation active state
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                const activeNavItem = document.querySelector(`[data-page="${pageName}"]`);
                if (activeNavItem) {
                    activeNavItem.classList.add('active');
                }
            }
        }

        // Authentication system
        function initializeAuth() {
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            if (loginBtn) {
                loginBtn.addEventListener('click', () => {
                    showNotification('🔐', 'Đăng nhập', 'Tính năng đăng nhập sẽ sớm được ra mắt!');
                });
            }

            if (registerBtn) {
                registerBtn.addEventListener('click', () => {
                    showNotification('📝', 'Đăng ký', 'Tính năng đăng ký sẽ sớm được ra mắt!');
                });
            }

            if (logoutBtn) {
                logoutBtn.addEventListener('click', () => {
                    showNotification('👋', 'Đăng xuất', 'Hẹn gặp lại bạn!');
                });
            }
        }

        // Recommendation system
        function initializeRecommendationSystem() {
            // Mood selector
            const moodSelectors = document.querySelectorAll('.mood-selector');
            moodSelectors.forEach(selector => {
                selector.addEventListener('click', function() {
                    // Remove active class from all selectors
                    moodSelectors.forEach(s => s.classList.remove('active'));
                    // Add active class to clicked selector
                    this.classList.add('active');
                    selectedMood = this.dataset.mood;
                    
                    // Update mood text
                    const moodText = document.getElementById('selectedMoodText');
                    const moodNames = {
                        'happy': 'Vui vẻ 😊',
                        'sad': 'Buồn 😢',
                        'stressed': 'Căng thẳng 😰',
                        'excited': 'Hứng thú 🤩',
                        'tired': 'Mệt mỏi 😴',
                        'romantic': 'Lãng mạn 😍'
                    };
                    if (moodText) {
                        moodText.textContent = `Tâm trạng: ${moodNames[selectedMood]}`;
                    }
                });
            });

            // Factor sliders
            const sliders = ['health', 'time', 'location', 'preference', 'mood', 'goal'];
            sliders.forEach(factor => {
                const slider = document.getElementById(factor + 'Slider');
                const valueDisplay = document.getElementById(factor + 'Value');
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', function() {
                        const value = this.value;
                        factorWeights[factor] = parseInt(value);
                        valueDisplay.textContent = value + '%';
                    });
                }
            });

            // Generate recommendations button
            const generateBtn = document.getElementById('generateRecommendations');
            if (generateBtn) {
                generateBtn.addEventListener('click', generateRecommendations);
            }

            // Regenerate button
            const regenerateBtn = document.getElementById('regenerateBtn');
            if (regenerateBtn) {
                regenerateBtn.addEventListener('click', generateRecommendations);
            }

            // Initialize recommendation chat
            initializeRecommendationChat();
        }

        function generateRecommendations() {
            // Show analysis results
            const analysisResults = document.getElementById('analysisResults');
            const foodRecommendations = document.getElementById('foodRecommendations');
            
            if (analysisResults) {
                analysisResults.style.display = 'block';
                updateAnalysisDisplay();
            }
            
            // Generate food recommendations after a short delay
            setTimeout(() => {
                if (foodRecommendations) {
                    foodRecommendations.style.display = 'block';
                    generateFoodCards();
                }
                
                // Show recommendation chat
                const recommendationChat = document.getElementById('recommendationChat');
                if (recommendationChat) {
                    recommendationChat.style.display = 'block';
                }
                
                // Scroll to results
                analysisResults.scrollIntoView({ behavior: 'smooth' });
            }, 1000);
            
            showNotification('🤖', 'AI đang phân tích', 'Đang tạo gợi ý món ăn phù hợp...');
        }

        function updateAnalysisDisplay() {
            // Update progress bars
            const factors = ['health', 'time', 'preference'];
            factors.forEach(factor => {
                const bar = document.getElementById(factor + 'Bar');
                const percent = document.getElementById(factor + 'Percent');
                if (bar && percent) {
                    bar.style.width = factorWeights[factor] + '%';
                    percent.textContent = factorWeights[factor] + '%';
                }
            });

            // Update recommendations based on weights
            const rec1 = document.getElementById('recommendation1');
            const rec2 = document.getElementById('recommendation2');
            const rec3 = document.getElementById('recommendation3');

            if (rec1 && rec2 && rec3) {
                if (factorWeights.health > 70) {
                    rec1.textContent = '✅ Ưu tiên món ăn healthy và ít calories';
                } else {
                    rec1.textContent = '🍽️ Tập trung vào hương vị và sự hài lòng';
                }

                if (factorWeights.time > 70) {
                    rec2.textContent = '⏱️ Chọn món nấu nhanh dưới 30 phút';
                } else {
                    rec2.textContent = '👨‍🍳 Có thể chọn món phức tạp hơn';
                }

                if (selectedMood) {
                    const moodRecommendations = {
                        'happy': '😊 Món ăn vui tươi, đầy màu sắc',
                        'sad': '🤗 Món ăn ấm áp, dễ tiêu hóa',
                        'stressed': '🧘 Món ăn nhẹ nhàng, giảm stress',
                        'excited': '🎉 Món ăn thú vị, đậm đà',
                        'tired': '💤 Món ăn bổ dưỡng, dễ ăn',
                        'romantic': '💕 Món ăn tinh tế, lãng mạn'
                    };
                    rec3.textContent = moodRecommendations[selectedMood] || '😋 Phù hợp sở thích cá nhân';
                }
            }
        }

        function calculateFoodScore(food) {
            let score = 0;
            let totalWeight = 0;

            // Health factor
            if (factorWeights.health > 0) {
                score += (food.health / 100) * factorWeights.health;
                totalWeight += factorWeights.health;
            }

            // Time factor (higher time score means quicker to prepare)
            if (factorWeights.time > 0) {
                score += (food.time / 100) * factorWeights.time;
                totalWeight += factorWeights.time;
            }

            // Preference factor
            if (factorWeights.preference > 0) {
                score += (food.preference / 100) * factorWeights.preference;
                totalWeight += factorWeights.preference;
            }

            // Mood factor
            if (selectedMood && food.mood.includes(selectedMood)) {
                score += factorWeights.mood;
                totalWeight += factorWeights.mood;
            }

            return totalWeight > 0 ? (score / totalWeight) * 100 : 0;
        }

        function generateFoodCards() {
            const container = document.getElementById('recommendationCards');
            if (!container) return;

            // Calculate scores for all foods
            const scoredFoods = foodDatabase.map(food => ({
                ...food,
                score: calculateFoodScore(food)
            }));

            // Sort by score and take top 3
            const topFoods = scoredFoods.sort((a, b) => b.score - a.score).slice(0, 3);

            // Generate cards
            container.innerHTML = topFoods.map((food, index) => {
                const colors = [
                    'from-blue-500 to-purple-600',
                    'from-green-500 to-teal-600',
                    'from-orange-500 to-red-600'
                ];
                
                const textColors = [
                    'text-blue-600',
                    'text-green-600',
                    'text-orange-600'
                ];

                return `
                    <div class="bg-gradient-to-r ${colors[index]} text-white rounded-xl p-6 text-center card-hover">
                        <div class="text-4xl mb-3">${food.emoji}</div>
                        <h3 class="text-xl font-bold mb-2">${food.name}</h3>
                        <p class="text-sm opacity-90 mb-4">${food.description}</p>
                        <div class="text-2xl font-bold mb-2">${Math.round(food.score)}%</div>
                        <div class="text-sm opacity-80 mb-4">Độ phù hợp</div>
                        <div class="text-xs opacity-75 mb-4">
                            ${food.calories} calories • ${food.cookTime}
                        </div>
                        <button class="bg-white ${textColors[index]} px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-all" onclick="selectFood('${food.name}')">
                            ${index === 0 ? 'Chọn món này' : index === 1 ? 'Xem công thức' : 'Thêm yêu thích'}
                        </button>
                    </div>
                `;
            }).join('');
        }

        function selectFood(foodName) {
            showNotification('🍽️', 'Đã chọn món', `Bạn đã chọn ${foodName}!`);
        }

        // Recommendation Chat System
        function initializeRecommendationChat() {
            const sendRecChatBtn = document.getElementById('sendRecChatBtn');
            const recChatInput = document.getElementById('recChatInput');
            const recQuickChatBtns = document.querySelectorAll('.rec-quick-chat-btn');
            
            if (sendRecChatBtn && recChatInput) {
                sendRecChatBtn.addEventListener('click', sendRecommendationMessage);
                recChatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendRecommendationMessage();
                    }
                });
            }
            
            recQuickChatBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const message = this.dataset.message;
                    if (recChatInput) {
                        recChatInput.value = message;
                        sendRecommendationMessage();
                    }
                });
            });
        }

        function sendRecommendationMessage() {
            const recChatInput = document.getElementById('recChatInput');
            const recChatContainer = document.getElementById('recChatContainer');
            
            if (!recChatInput || !recChatContainer) return;
            
            const message = recChatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addRecommendationChatMessage(message, 'user');
            recChatInput.value = '';
            
            // Process AI response
            setTimeout(() => {
                const aiResponse = processRecommendationAIRequest(message);
                addRecommendationChatMessage(aiResponse, 'ai');
                
                // Update recommendations based on request
                if (message.toLowerCase().includes('thay') || message.toLowerCase().includes('đổi')) {
                    setTimeout(() => {
                        generateFoodCards();
                        showNotification('🔄', 'Đã cập nhật', 'Gợi ý món ăn đã được điều chỉnh!');
                    }, 1500);
                }
            }, 1000);
        }

        function addRecommendationChatMessage(message, sender) {
            const recChatContainer = document.getElementById('recChatContainer');
            if (!recChatContainer) return;
            
            const isUser = sender === 'user';
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message mb-3`;
            
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}">
                    <div class="text-2xl">${isUser ? '👤' : '🤖'}</div>
                    <div class="${isUser ? 'bg-viet-red text-white' : 'bg-blue-100'} rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                </div>
            `;
            
            recChatContainer.appendChild(messageDiv);
            recChatContainer.scrollTop = recChatContainer.scrollHeight;
        }

        function processRecommendationAIRequest(message) {
            const lowerMessage = message.toLowerCase();
            
            // Handle specific food preferences
            if (lowerMessage.includes('không thích cay') || lowerMessage.includes('không cay')) {
                // Filter out spicy foods
                return 'Tôi hiểu bạn không thích cay! Tôi sẽ loại bỏ các món cay như bún bò Huế, lẩu Thái và thay bằng những món nhẹ nhàng hơn như cháo, phở, salad.';
            }
            
            if (lowerMessage.includes('chay') || lowerMessage.includes('vegetarian')) {
                return 'Tuyệt! Tôi sẽ gợi ý các món chay bổ dưỡng như salad quinoa, cơm chay, súp rau củ. Các món này vừa healthy vừa ngon miệng!';
            }
            
            if (lowerMessage.includes('tráng miệng') || lowerMessage.includes('dessert')) {
                return 'Tôi sẽ thêm một số món tráng miệng nhẹ nhàng như chè, smoothie bowl, trái cây tươi để hoàn thiện bữa ăn của bạn!';
            }
            
            if (lowerMessage.includes('nhanh') || lowerMessage.includes('fast')) {
                return 'Tôi sẽ ưu tiên các món ăn nhanh như sandwich, salad, mì ý, bánh mì - những món có thể chuẩn bị trong 15-20 phút!';
            }
            
            if (lowerMessage.includes('thay') || lowerMessage.includes('đổi')) {
                return 'Đã hiểu! Tôi sẽ thay đổi gợi ý món ăn theo yêu cầu của bạn. Vui lòng đợi một chút để tôi tìm những món phù hợp hơn...';
            }
            
            if (lowerMessage.includes('protein') || lowerMessage.includes('gym')) {
                return 'Tôi sẽ tập trung vào các món giàu protein như cơm gà, salad với thịt nướng, trứng để hỗ trợ tập luyện của bạn!';
            }
            
            if (lowerMessage.includes('giảm cân') || lowerMessage.includes('diet')) {
                return 'Tôi sẽ chọn những món ít calories, nhiều chất xơ như salad, súp rau, cháo để hỗ trợ mục tiêu giảm cân của bạn!';
            }
            
            // Default responses
            const responses = [
                'Tôi hiểu sở thích của bạn! Hãy cho tôi biết cụ thể hơn về món nào bạn muốn thay đổi.',
                'Bạn có thể mô tả rõ hơn về khẩu vị hoặc loại món ăn bạn yêu thích không?',
                'Tôi sẵn sàng điều chỉnh gợi ý theo ý bạn! Bạn muốn thay đổi gì?'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Meal Plan System
        let currentWeekPlan = {};
        let chatHistory = [];

        function initializeMealPlan() {
            generateWeeklyPlan();
            initializeChat();
            
            // Event listeners
            const generatePlanBtn = document.getElementById('generatePlanBtn');
            const generateSmartPlanBtn = document.getElementById('generateSmartPlanBtn');
            const savePlanBtn = document.getElementById('savePlanBtn');
            const prevWeekBtn = document.getElementById('prevWeekBtn');
            const nextWeekBtn = document.getElementById('nextWeekBtn');
            
            if (generatePlanBtn) {
                generatePlanBtn.addEventListener('click', () => {
                    generateWeeklyPlan();
                    showNotification('🎯', 'Kế hoạch mới', 'Đã tạo kế hoạch ăn uống mới!');
                });
            }
            
            if (generateSmartPlanBtn) {
                generateSmartPlanBtn.addEventListener('click', () => {
                    generateSmartWeeklyPlan();
                    showNotification('🤖', 'AI đang tạo', 'Đang tạo kế hoạch thông minh theo sở thích...');
                });
            }
            
            if (savePlanBtn) {
                savePlanBtn.addEventListener('click', () => {
                    showNotification('💾', 'Đã lưu', 'Kế hoạch đã được lưu thành công!');
                });
            }
            
            if (prevWeekBtn) {
                prevWeekBtn.addEventListener('click', () => {
                    showNotification('📅', 'Tuần trước', 'Đang tải kế hoạch tuần trước...');
                });
            }
            
            if (nextWeekBtn) {
                nextWeekBtn.addEventListener('click', () => {
                    showNotification('📅', 'Tuần sau', 'Đang tải kế hoạch tuần sau...');
                });
            }
        }

        function generateWeeklyPlan() {
            const days = ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'Chủ nhật'];
            const meals = ['Sáng', 'Trưa', 'Tối'];
            const mealColors = ['bg-yellow-100 border-yellow-300', 'bg-green-100 border-green-300', 'bg-blue-100 border-blue-300'];
            const mealIcons = ['☀️', '🌞', '🌙'];
            
            const weeklyPlanContainer = document.getElementById('weeklyPlan');
            if (!weeklyPlanContainer) return;
            
            currentWeekPlan = {};
            
            weeklyPlanContainer.innerHTML = days.map((day, dayIndex) => {
                currentWeekPlan[day] = {};
                
                const dayMeals = meals.map((meal, mealIndex) => {
                    const randomFood = foodDatabase[Math.floor(Math.random() * foodDatabase.length)];
                    currentWeekPlan[day][meal] = randomFood;
                    
                    return `
                        <div class="${mealColors[mealIndex]} border-2 p-4 rounded-xl cursor-pointer hover:shadow-lg hover:scale-105 transition-all meal-card" 
                             data-day="${day}" data-meal="${meal}" onclick="editMeal('${day}', '${meal}')">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-lg">${mealIcons[mealIndex]}</span>
                                <span class="text-xs font-bold text-gray-600">${meal}</span>
                            </div>
                            <div class="text-3xl mb-2 text-center">${randomFood.emoji}</div>
                            <div class="text-sm font-semibold text-center mb-1">${randomFood.name}</div>
                            <div class="text-xs text-gray-500 text-center">${randomFood.calories} cal</div>
                            <div class="text-xs text-gray-400 text-center mt-1">${randomFood.cookTime}</div>
                        </div>
                    `;
                }).join('');
                
                return `
                    <div class="bg-white rounded-xl p-4 shadow-md">
                        <h3 class="font-bold text-lg mb-4 text-center text-viet-red border-b pb-2">${day}</h3>
                        <div class="space-y-3">
                            ${dayMeals}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateNutritionSummary();
        }

        function generateSmartWeeklyPlan() {
            const healthGoal = document.getElementById('healthGoalSelect')?.value || 'maintain';
            const cookingTime = document.getElementById('cookingTimeSelect')?.value || 'any';
            const dietType = document.getElementById('dietTypeSelect')?.value || 'normal';
            
            const days = ['Thứ 2', 'Thứ 3', 'Thứ 4', 'Thứ 5', 'Thứ 6', 'Thứ 7', 'Chủ nhật'];
            const meals = ['Sáng', 'Trưa', 'Tối'];
            const mealColors = ['bg-yellow-100 border-yellow-300', 'bg-green-100 border-green-300', 'bg-blue-100 border-blue-300'];
            const mealIcons = ['☀️', '🌞', '🌙'];
            
            const weeklyPlanContainer = document.getElementById('weeklyPlan');
            if (!weeklyPlanContainer) return;
            
            currentWeekPlan = {};
            
            weeklyPlanContainer.innerHTML = days.map((day, dayIndex) => {
                currentWeekPlan[day] = {};
                
                const dayMeals = meals.map((meal, mealIndex) => {
                    const mealType = meal.toLowerCase() === 'sáng' ? 'breakfast' : 
                                   meal.toLowerCase() === 'trưa' ? 'lunch' : 'dinner';
                    
                    // Filter foods based on preferences
                    let filteredFoods = foodDatabase.filter(food => {
                        let matches = true;
                        
                        // Filter by meal type
                        if (food.type && food.type !== mealType) {
                            matches = false;
                        }
                        
                        // Filter by diet type
                        if (dietType === 'vegetarian' && food.category !== 'vegetarian') {
                            matches = false;
                        } else if (dietType === 'healthy' && food.health < 80) {
                            matches = false;
                        } else if (dietType === 'traditional' && food.category !== 'traditional') {
                            matches = false;
                        }
                        
                        // Filter by cooking time
                        if (cookingTime === 'quick' && food.time < 70) {
                            matches = false;
                        } else if (cookingTime === 'medium' && (food.time < 40 || food.time > 70)) {
                            matches = false;
                        } else if (cookingTime === 'slow' && food.time > 60) {
                            matches = false;
                        }
                        
                        // Filter by health goal
                        if (healthGoal === 'lose' && food.calories > 350) {
                            matches = false;
                        } else if (healthGoal === 'gain' && food.calories < 300) {
                            matches = false;
                        } else if (healthGoal === 'muscle' && food.health < 75) {
                            matches = false;
                        }
                        
                        return matches;
                    });
                    
                    // If no foods match criteria, use all foods of that meal type
                    if (filteredFoods.length === 0) {
                        filteredFoods = foodDatabase.filter(food => !food.type || food.type === mealType);
                    }
                    
                    // If still no foods, use all foods
                    if (filteredFoods.length === 0) {
                        filteredFoods = foodDatabase;
                    }
                    
                    const selectedFood = filteredFoods[Math.floor(Math.random() * filteredFoods.length)];
                    currentWeekPlan[day][meal] = selectedFood;
                    
                    return `
                        <div class="${mealColors[mealIndex]} border-2 p-4 rounded-xl cursor-pointer hover:shadow-lg hover:scale-105 transition-all meal-card" 
                             data-day="${day}" data-meal="${meal}" onclick="editMeal('${day}', '${meal}')">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-lg">${mealIcons[mealIndex]}</span>
                                <span class="text-xs font-bold text-gray-600">${meal}</span>
                            </div>
                            <div class="text-3xl mb-2 text-center">${selectedFood.emoji}</div>
                            <div class="text-sm font-semibold text-center mb-1">${selectedFood.name}</div>
                            <div class="text-xs text-gray-500 text-center">${selectedFood.calories} cal</div>
                            <div class="text-xs text-gray-400 text-center mt-1">${selectedFood.cookTime}</div>
                            <div class="text-xs text-center mt-2">
                                <span class="bg-white px-2 py-1 rounded-full text-gray-600">
                                    ${getHealthGoalBadge(selectedFood, healthGoal)}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                return `
                    <div class="bg-white rounded-xl p-4 shadow-md">
                        <h3 class="font-bold text-lg mb-4 text-center text-viet-red border-b pb-2">${day}</h3>
                        <div class="space-y-3">
                            ${dayMeals}
                        </div>
                    </div>
                `;
            }).join('');
            
            updateNutritionSummary();
            
            // Show success message with plan details
            setTimeout(() => {
                const goalText = {
                    'maintain': 'duy trì sức khỏe',
                    'lose': 'giảm cân',
                    'gain': 'tăng cân',
                    'muscle': 'tăng cơ bắp'
                };
                
                const dietText = {
                    'normal': 'bình thường',
                    'vegetarian': 'chay',
                    'healthy': 'healthy',
                    'traditional': 'truyền thống'
                };
                
                showNotification('✅', 'Hoàn thành!', `Đã tạo kế hoạch ${goalText[healthGoal]} với chế độ ăn ${dietText[dietType]}!`);
            }, 1500);
        }

        function getHealthGoalBadge(food, healthGoal) {
            switch(healthGoal) {
                case 'lose':
                    return food.calories < 300 ? '🔥 Giảm cân' : '⚡ Năng lượng';
                case 'gain':
                    return food.calories > 400 ? '💪 Tăng cân' : '🍽️ Bổ dưỡng';
                case 'muscle':
                    return food.health > 80 ? '🏋️ Tăng cơ' : '💪 Protein';
                default:
                    return food.health > 85 ? '🌟 Healthy' : '😋 Ngon';
            }
        }

        function editMeal(day, meal) {
            const chatInput = document.getElementById('chatInput');
            if (chatInput) {
                chatInput.value = `Thay món ${meal.toLowerCase()} ${day} thành `;
                chatInput.focus();
            }
        }

        function updateNutritionSummary() {
            let totalCalories = 0;
            let mealCount = 0;
            
            Object.values(currentWeekPlan).forEach(dayPlan => {
                Object.values(dayPlan).forEach(meal => {
                    totalCalories += meal.calories;
                    mealCount++;
                });
            });
            
            const avgCaloriesPerDay = Math.round(totalCalories / 7);
            
            const weeklyCalories = document.getElementById('weeklyCalories');
            const weeklyProtein = document.getElementById('weeklyProtein');
            const weeklyCarbs = document.getElementById('weeklyCarbs');
            const weeklyFat = document.getElementById('weeklyFat');
            
            if (weeklyCalories) weeklyCalories.textContent = avgCaloriesPerDay.toLocaleString();
            if (weeklyProtein) weeklyProtein.textContent = Math.round(avgCaloriesPerDay * 0.15 / 4) + 'g';
            if (weeklyCarbs) weeklyCarbs.textContent = Math.round(avgCaloriesPerDay * 0.55 / 4) + 'g';
            if (weeklyFat) weeklyFat.textContent = Math.round(avgCaloriesPerDay * 0.30 / 9) + 'g';
        }

        // AI Chat System
        function initializeChat() {
            const sendChatBtn = document.getElementById('sendChatBtn');
            const chatInput = document.getElementById('chatInput');
            const quickChatBtns = document.querySelectorAll('.quick-chat-btn');
            
            if (sendChatBtn && chatInput) {
                sendChatBtn.addEventListener('click', sendMessage);
                chatInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
            
            quickChatBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const message = this.dataset.message;
                    if (chatInput) {
                        chatInput.value = message;
                        sendMessage();
                    }
                });
            });
        }

        function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const chatContainer = document.getElementById('chatContainer');
            
            if (!chatInput || !chatContainer) return;
            
            const message = chatInput.value.trim();
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            chatInput.value = '';
            
            // Process AI response
            setTimeout(() => {
                const aiResponse = processAIRequest(message);
                addChatMessage(aiResponse, 'ai');
            }, 1000);
        }

        function addChatMessage(message, sender) {
            const chatContainer = document.getElementById('chatContainer');
            if (!chatContainer) return;
            
            const isUser = sender === 'user';
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}-message mb-3`;
            
            messageDiv.innerHTML = `
                <div class="flex items-start space-x-3 ${isUser ? 'flex-row-reverse space-x-reverse' : ''}">
                    <div class="text-2xl">${isUser ? '👤' : '🤖'}</div>
                    <div class="${isUser ? 'bg-viet-red text-white' : 'bg-blue-100'} rounded-lg p-3 max-w-xs">
                        <p class="text-sm">${message}</p>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function processAIRequest(message) {
            const lowerMessage = message.toLowerCase();
            
            // Detect meal change requests
            if (lowerMessage.includes('thay') || lowerMessage.includes('đổi')) {
                const days = ['thứ 2', 'thứ 3', 'thứ 4', 'thứ 5', 'thứ 6', 'thứ 7', 'chủ nhật'];
                const meals = ['sáng', 'trưa', 'tối'];
                
                let foundDay = null;
                let foundMeal = null;
                
                days.forEach(day => {
                    if (lowerMessage.includes(day)) {
                        foundDay = day.charAt(0).toUpperCase() + day.slice(1);
                    }
                });
                
                meals.forEach(meal => {
                    if (lowerMessage.includes(meal)) {
                        foundMeal = meal.charAt(0).toUpperCase() + meal.slice(1);
                    }
                });
                
                if (foundDay && foundMeal) {
                    // Find a suitable replacement
                    let newFood;
                    if (lowerMessage.includes('healthy') || lowerMessage.includes('khỏe')) {
                        newFood = foodDatabase.filter(f => f.health > 80)[Math.floor(Math.random() * foodDatabase.filter(f => f.health > 80).length)];
                    } else if (lowerMessage.includes('nhanh') || lowerMessage.includes('quick')) {
                        newFood = foodDatabase.filter(f => f.time > 70)[Math.floor(Math.random() * foodDatabase.filter(f => f.time > 70).length)];
                    } else {
                        newFood = foodDatabase[Math.floor(Math.random() * foodDatabase.length)];
                    }
                    
                    // Update the meal plan
                    if (currentWeekPlan[foundDay]) {
                        currentWeekPlan[foundDay][foundMeal] = newFood;
                        generateWeeklyPlan(); // Refresh the display
                        updateNutritionSummary();
                        
                        return `Đã thay món ${foundMeal.toLowerCase()} ${foundDay} thành ${newFood.name} ${newFood.emoji}! Món này có ${newFood.calories} calories và rất phù hợp với yêu cầu của bạn.`;
                    }
                }
            }
            
            // Handle general requests
            if (lowerMessage.includes('healthy') || lowerMessage.includes('khỏe')) {
                return 'Tôi sẽ ưu tiên các món ăn healthy với nhiều rau xanh và ít calories. Bạn có muốn tôi thay đổi toàn bộ kế hoạch theo hướng healthy không?';
            }
            
            if (lowerMessage.includes('việt nam') || lowerMessage.includes('việt')) {
                return 'Tuyệt! Tôi sẽ tập trung vào các món ăn Việt Nam truyền thống như phở, bún, cơm tấm. Bạn có món Việt nào yêu thích đặc biệt không?';
            }
            
            if (lowerMessage.includes('calories') || lowerMessage.includes('giảm cân')) {
                return 'Tôi sẽ chọn những món ăn ít calories và giàu protein để hỗ trợ giảm cân. Mục tiêu calories hàng ngày của bạn là bao nhiêu?';
            }
            
            if (lowerMessage.includes('nhanh') || lowerMessage.includes('nấu nhanh')) {
                return 'Tôi hiểu bạn cần những món nấu nhanh! Tôi sẽ ưu tiên các món có thể hoàn thành trong 30 phút như salad, sandwich, mì ý...';
            }
            
            // Default responses
            const responses = [
                'Tôi hiểu yêu cầu của bạn! Hãy cho tôi biết cụ thể hơn về món ăn hoặc ngày bạn muốn thay đổi.',
                'Bạn có thể nói rõ hơn về món ăn nào bạn muốn thay đổi không? Ví dụ: "Thay món sáng thứ 2 thành cháo"',
                'Tôi sẵn sàng giúp bạn điều chỉnh kế hoạch! Bạn muốn thay đổi theo hướng nào?'
            ];
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        // Notification system
        function showNotification(icon, title, message) {
            const notification = document.getElementById('notification');
            const notificationIcon = document.getElementById('notificationIcon');
            const notificationTitle = document.getElementById('notificationTitle');
            const notificationMessage = document.getElementById('notificationMessage');
            
            if (notification && notificationIcon && notificationTitle && notificationMessage) {
                notificationIcon.textContent = icon;
                notificationTitle.textContent = title;
                notificationMessage.textContent = message;
                
                notification.classList.add('show');
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 3000);
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'971b710254630959',t:'MTc1NTYyNTI4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
